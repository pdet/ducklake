# name: test/sql/macros/test_macro_self_dependency.test
# description: test table macros
# group: [macros]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__

statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/test_defined_types');

statement ok
USE ducklake;

statement ok
create macro m1(a) as a+1;

statement ok
create macro m2(a) as m1(a)+1;

# statement error
# create or replace macro m1(a) as m2(a)+1;
# ----
# Catalog Error: CREATE OR REPLACE is not allowed to depend on itself