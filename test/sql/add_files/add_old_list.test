# name: test/sql/add_files/add_old_list.test
# description: test ducklake adding a parquet file with legacy avro list layout
# group: [add_files]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__

statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/add_old_list');

statement ok
USE ducklake

# statement ok
# CREATE TABLE test AS SELECT * FROM read_parquet('/Users/holanda/Desktop/old_list_structure.parquet')
# WITH NO DATA;
#
# statement ok
# CALL ducklake_add_data_files('ducklake', 'test', '/Users/holanda/Desktop/old_list_structure.parquet')
#
# query I
# FROM test;
# ----
# [[1, 2], [3, 4]]


statement ok
create or replace table location as (select * from read_parquet('/Users/holanda/Desktop/s3/kafka-topics-dev/io.transportcloud.location-dev-popcorn-only/popcorn-location-updates-dev/dt=2025-10-10/*.parquet', union_by_name => true) limit 0);

statement ok
call ducklake_add_data_files('ducklake', 'location', '/Users/holanda/Desktop/s3/kafka-topics-dev/io.transportcloud.location-dev-popcorn-only/popcorn-location-updates-dev/dt=2025-10-10/2025-10-10-09:01:02_578.parquet');

query I
FROM location
----